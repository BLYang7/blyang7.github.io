---
layout: post
title: 关于Java线程池
categories: Java语言

---

>Java线程池的使用可以减小系统开销，提升服务器性能

### 问题概述

在有些工作场景中，比如说服务器编程中，如果为每一个客户都分配一个新的工作线程，并且当工作线程与客户通信结束时，这个线程被销毁，这就需要频繁的切换工作线程，这会带来一些负担，最主要的是系统大的开销和系统资源不足问题。

* 首先，服务器创建和销毁工作线程的开销很大，如果服务器与很多客户端通信，并且与每个客户端通信的时间很短，那么就会在创建和销毁线程的时候造成很大的开销。
* 其次，活动的线程也消耗系统资源，如果线程的创建数量没有限制，当大量的客户连接服务器的时候，就会创建出大量的工作线程，他们会消耗大量的内存空间，导致系统的内存空间不足，影响服务器的使用。
* 最后，如果线程的数目固定，并且每个线程都有很长的生命周期，那么线程切换也就是固定的，这样就会给服务器减轻很多压力，但是如果频繁的创建和销毁线程，必将导致频繁的切换线程，使得线程之间的切换不再遵循系统的固定切换周期，线程切换的开销也会增大很多。

<br/>

#### 解决方案
线程池为这些问题提供了解决方案。线程池中预先创建了一些工作线程，他们不断的从工作队列中取出任务，然后执行，当执行完之后，会继续执行工作队列中的下一个任务，减少了创建和销毁线程的次数，每个线程都可以一直被重用，避免了创建和销毁的开销。另外，可以根据系统的实际承载能力，方便的调节线程池中线程的数目，防止因为消耗过量的系统资源而导致系统崩溃的问题。

**线程池在系统启动时会创建大量空闲的线程，当线程对象传递给线程池之后，线程池就会启动其中一个线程来执行该对象的run或者call方法。执行完毕后，该线程并不会消亡，而是返回线程池，变成空闲状态。等待执行下一个run或者call方法。**

举个例子，首先创建一个Runnable的实现类，然后在主进程中创建一个线程池，在线程池对象中调用submit方法，提交一个Runnable对象实例或者是Callable对象实例。当任务提交完毕时，调用线程池的shutdown方法来关闭线程池。具体代码如下：

```
// 实现Runnable接口来定义一个简单的线程类  
class MyThread implements Runnable{  
    public void run(){  
        for (int i = 0; i < 100 ; i++ ){  
            System.out.println(Thread.currentThread().getName()+"的i值为:"+i);  
        }  
    }  
}  
public class ThreadPoolTest{  
    public static void main(String[] args) throws Exception{  
        // 创建一个具有固定线程数（6）的线程池  
        ExecutorService pool = Executors.newFixedThreadPool(6);  
        // 向线程池中提交两个线程  
        pool.submit(new MyThread());  
        pool.submit(new MyThread());  
        // 关闭线程池  
        pool.shutdown();  
    }  
}  
```

